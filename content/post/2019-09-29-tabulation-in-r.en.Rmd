---
title: Tabulation in R
author: Jay Achar
date: '2019-09-29'
slug: tabulation-in-r
featured: "tech-drawing.jpeg"
featuredalt: "technical drawing"
categories:
  - reporting
tags:
  - research
  - R
  - programming
description: 'Research quality summary tables using arsenal'
type: post
---
Last week, I was drafting a report to summarise some data generated by one of the programmes I support. When I looked online for any packages that might simplify this, I realised that there were a number of different options. Importantly, I wasn't so interested in generating summary statistics, but to do this and present them in a way that would be acceptable for reporting purposes including research manuscripts.

I ended up reading <a href="https://thatdatatho.com/2018/08/20/easily-create-descriptive-summary-statistic-tables-r-studio/" target="_blank">this post</a> from Pascal Schmidt which is a great summary some of the packages out there for this purpose.

My ultimate choice was the `arsenal` package which seemed to offer a huge number of features to customise outputs as well as some excellent documentation <a href="https://cran.r-project.org/web/packages/arsenal/" target="_blank">here</a>. `arsenal` is available on CRAN with a Github repo <a href="https://github.com/eheinzen/arsenal" target="_blank">here</a>.

I'm writing this blog post as I learn some of the more advanced features to try and remember how best to use this package in the future.

# Example data

Where better to find some example data than within the package itself:

```{r example-data, comment=""}
library(arsenal)  # load library
data(mockstudy)   # load package data
str(mockstudy)    # show structure of data
```

# tableby

The `tableby` function is designed to generate summary statistics, stratified by groups if required, and output them in Rmarkdown format. I'll focus on this function within this post, because there's a lot to dig into.

The function requires a formula to define which variables to output in the table. A very simple example is shown below where a table summarising two variables - age and sex - is generated.

```{r simple-tableby, comment=""}
table_simple <- tableby(formula = ~ age + sex,
             data = mockstudy)

summary(table_simple)
```

Adding `results="asis"` to the code-chunk options in the Rmarkdown document produces a more polished version of the output. If the output of the Rmarkdown file is to html, then the output will be affected by any CSS stylesheet being used.

```{r simple-tableby-asis, results="asis", echo=FALSE}
htmltools::HTML("<div class='r-table'>")
summary(table_simple)
htmltools::HTML("</div>")
```

The output can also be easily stratified by a designated group by adjusting the formula provided:
```{r bivar-table, eval=FALSE, comment=""}
table_bivar <- tableby(formula = sex ~ age + ast + bmi,
             data = mockstudy)

summary(table_bivar)
```

```{r results="asis", echo=FALSE}
table_bivar <- tableby(formula = sex ~ age + ast + bmi,
             data = mockstudy)
htmltools::HTML("<div class='r-table'>")
summary(table_bivar)
htmltools::HTML("</div>")
```


## tableby.control

Being able to control the statistical output of the `tableby` object was one of the main reasons I chose `arsenal` over other R packages. The number of arguments is impressive, although somewhat daunting at the same time. I'll try and run through some of the options that I use regularly.

```{r table-options, comment="", eval=FALSE}
# define tableby options using tableby.control
control_options <- tableby.control(
  # name for p-value column
  test.pname = "p-value",
  # round figures
  digits = 2L,
  # define which statistics to show for numeric variables
  numeric.stats = c("N", "Nmiss", "medianq1q3"),
  # statistics for categorical variables
  cat.stats = c("countN", "Nmiss2")
  )

# create output table using formula
table_options <- tableby(formula = sex ~ race + age.ord + bmi,
                         data = mockstudy,
                         control = control_options)

summary(table_options)
```

```{r results="asis", echo=FALSE, warning=FALSE}
control_options <- tableby.control(
  test.pname = "p-value",
  digits = 2L,
  numeric.stats = c("N", "Nmiss", "medianq1q3"),
  cat.stats = c("countN", "Nmiss2")
  )
table_options <- tableby(formula = sex ~ race + age.ord + bmi,
                         data = mockstudy,
                         control = control_options)
# output table with new labels
htmltools::HTML("<div class='r-table'>")
summary(table_options)
htmltools::HTML("</div>")
```

To remove the column of p-values use `test = FALSE`, and similarily `total = FALSE` removes the group total column.

# Label variables

There are multiple ways of customising the variable names in the output table. The first approach is to use the `base::labels()` function to add or edit variable labels in your data.frame object.
The alternative is to specify label names after generating your output table:

```{r label-simple, commment="", eval=FALSE}
new_labels <- list(sex = "Gender",
                   age = "Age (yrs)")

summary(table_simple, labelTranslations = new_labels)
```
```{r results="asis", echo=FALSE}
new_labels <- list(sex = "Gender",
                   age = "Age (yrs)")
htmltools::HTML("<div class='r-table'>")
summary(table_simple, labelTranslations = new_labels)
htmltools::HTML("</div>")
```


Adding labels to your data.frame would allow their use in every subsequent table without the need to retype variable names - maybe this would be a better appraoch than applying labels after the table has been generated.

# Thoughts

The `tableby()` function within the `arsenal` package really does fulfill many of my current reporting needs. By combining it with Rmarkdown and HTML/CSS, the options for presenting statistical data are never-ending.

The package has some other functions which I might explore in the coming weeks.

With descriptive statistics being presented reasonably easily now with the `tableby()` function, I'm next going to be on the look-out for a package to help present model output data effectively. If you have any suggestions, please send me a message or leave a comment below.
